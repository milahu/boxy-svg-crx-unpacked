(function() {"use strict";var _createClass=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var keys=Object.keys,Main=function(){function a(){var b=this;_classCallCheck(this,a),this._appWindow=null,this._appWindowState="closed",this._messageCounter=0,this._messageRequestCallbacks={},this._messageResponseCallbacks={},this._retainedLaunchEntries=[],chrome.app.runtime.onLaunched.addListener(function(a){return b._onLaunched(a)}),window.addEventListener("message",function(a){return b._onMessage(a)}),this.addMessageListener("ready",function(a,c){b._appWindowState="ready",c(b._retainedLaunchEntries)})}return _createClass(a,[{key:"_onLaunched",value:function(a){var b=this,c=a.items?a.items.map(function(a){return chrome.fileSystem.retainEntry(a.entry)}):null;if("ready"===this._appWindowState)this._appWindow.focus(),this._appWindow.show(),c&&0<c.length&&this.postMessage("openTabs",c);else if("opening"===this._appWindowState)c&&(this._retainedLaunchEntries=c);else if("closed"===this._appWindowState){c&&(this._retainedLaunchEntries=c);{this._appWindowState="opening";var d,e;chrome.app.window.create("chrome-app.html",{id:"master",resizable:!0,hidden:!1,frame:{type:"none"},outerBounds:{width:800,height:550,minWidth:100,minHeight:440}},function(a){b._appWindow=a,b._appWindow.contentWindow.addEventListener("load",d=function(){b._appWindow.contentWindow.removeEventListener("load",d),b._appWindow.focus(),b._appWindow.show()}),b._appWindow.onClosed.addListener(e=function(){b._appWindow.onClosed.removeListener(e),b._appWindow.contentWindow.removeEventListener("load",d),b._appWindow=null,b._appWindowState="closed",b._retainedLaunchEntries=[]})})}}}},{key:"_onMessage",value:function(a){var b=this;if(this._appWindow&&a.source===this._appWindow.contentWindow){var c=a.data,d=c.channel,e=c.id,f=c.name,g=c.arg;"request"===d?this._messageRequestCallbacks[f]&&this._messageRequestCallbacks[f].forEach(function(a){a(g,function(a){b._appWindow.contentWindow.postMessage({channel:"response",id:e,name:f,arg:a},"*")})}):"response"===d&&this._messageResponseCallbacks[e]&&(this._messageResponseCallbacks[e](g),delete this._messageResponseCallbacks[e])}}},{key:"postMessage",value:function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(this._appWindow){var d=this._messageCounter++,e={channel:"request",id:d,name:a,arg:b};c&&(this._messageResponseCallbacks[e.id]=c),this._appWindow.contentWindow.postMessage(e,"*")}}},{key:"addMessageListener",value:function(a,b){this._messageRequestCallbacks[a]||(this._messageRequestCallbacks[a]=[]),this._messageRequestCallbacks[a].push(b)}},{key:"removeMessageListener",value:function(a,b){this._messageRequestCallbacks[a]&&(this._messageRequestCallbacks[a]=this._messageRequestCallbacks[a].filter(function(a){return a!==b}))}}]),a}();new Main;})()