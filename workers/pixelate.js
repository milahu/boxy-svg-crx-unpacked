let e={columns:20,rows:20,pixelShape:"rectangle",pixelSize:.9,renderAs:"paths",geometryPrecision:3};self.addEventListener("message",(i=>{let[a,f]=i.data;f=t(e,f);let $=r(a),{width:h,height:p}=a,{columns:n,rows:o,pixelShape:c,pixelSize:g,renderAs:b,geometryPrecision:u}=f,y=h/n,d=p/o,x=`<svg viewBox="0 0 ${h} ${p}">`;if("rectangle"===c)for(let e=0;e<n;e+=1)for(let t=0;t<o;t+=1){let r=e*y,i=t*d,f=s((r+y/2)/h,(i+d/2)/p,a,$);if("rgba(0,0,0,0)"!==f){let e=y*g,t=d*g,s=r+y/2-e/2,a=i+d/2-t/2;if("shapes"===b){let r={x:l(s,u),y:l(a,u),width:l(e,u),height:l(t,u),style:`fill: ${f};`};x+=`<rect ${Object.entries(r).map((([e,t])=>`${e}="${t}"`)).join(" ")}></rect>`}else if("paths"===b){let r={d:[["M",l(s,u),l(a,u)],["H",l(s+e,u)],["V",l(a+t,u)],["H",l(s,u)],["V",l(a,u)],["Z"]].map((e=>e.join(" "))).join(" "),style:`fill: ${f};`};x+=`<path ${Object.entries(r).map((([e,t])=>`${e}="${t}"`)).join(" ")}></path>`}}}else if("ellipse"===c)for(let e=0;e<n;e+=1)for(let t=0;t<o;t+=1){let r=e*y+y/2,i=t*d+d/2,f=y/2*g,n=d/2*g,o=s(r/h,i/p,a,$);if("rgba(0,0,0,0)"!==o)if(r=l(r,u),i=l(i,u),f=l(f,u),n=l(n,u),"shapes"===b){let e={cx:l(r,u),cy:l(i,u),rx:l(f,u),ry:l(n,u),style:`fill: ${o};`};x+=`<ellipse ${Object.entries(e).map((([e,t])=>`${e}="${t}"`)).join(" ")}></ellipse>`}else if("paths"===b){let e=u,t={d:[["M",l(r-f,e),l(i,e)],["a",l(f,e),l(n,e),0,1,0,l(2*f,e),0],["a",l(f,e),l(n,e),0,1,0,l(-2*f,e),0],["Z"]].map((e=>e.join(" "))).join(" "),style:`fill: ${o};`};x+=`<path ${Object.entries(t).map((([e,t])=>`${e}="${t}"`)).join(" ")}></path>`}}x+="</svg>",self.postMessage(x)}));let t=(e,t)=>{let l={};for(let[r,s]of Object.entries(e))l[r]=void 0!==t[r]?t[r]:e[r];return l},l=(e,t=0)=>{let l=Math.pow(10,t);return Math.round((e+Number.EPSILON)*l)/l},r=e=>{let t=new OffscreenCanvas(e.width,e.height).getContext("2d");t.drawImage(e,0,0);let l=t.getImageData(0,0,e.width,e.height),r=[];for(let e=0;e<l.data.length;e+=4)r.push([l.data[e],l.data[e+1],l.data[e+2],l.data[e+3]]);return r},s=(e,t,l,r)=>{let s=r[Math.round(e*l.width)+Math.round(t*l.height)*l.width],a="rgba(0,0,0,0)";return s&&(a=i(...s)),a},i=(e,t,r,s)=>{let i=e=>{let t=e.toString(16);return 1==t.length?"0"+t:t};return 255===s?"#"+i(e)+i(t)+i(r):0===s?"rgba(0,0,0,0)":`rgba(${e},${t},${r},${s=l(s/255,2)})`};